 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <title>Interactive Image Editing</title>
    <style>
        canvas {
            border: 1px solid #ccc;
            cursor: crosshair;
        }
    </style>
</head>
<body>
    <h3>Upload an Excel File</h1>
            <input type="file" id="fileInput">
            <button onclick="uploadFile()">Upload</button>
        
            <script>
                function uploadFile() {
                    const fileInput = document.getElementById('fileInput');
                    const file = fileInput.files[0];
        
                    if (!file) {
                        alert('Please select a file.');
                        return;
                    }
        
                    const formData = new FormData();
                    formData.append('file', file);
        
                    fetch('/upload', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.text())
                    .then(data => {
                        console.log(data); // Handle server response
                        alert('File uploaded successfully.');
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred during file upload.');
                    });
                }
            </script>
        
        
    </form>
    <h3>Interactive Image Editing</h1>
    <label for="template">Choose a template:</label>
    <select id="template" onchange="loadTemplate()">
        <option value="/static/template1.jpg">Template 1</option>
        <option value="/static/template2.jpg">Template 2</option>
        
    </select>
    <br><br>
    <canvas id="imageCanvas" width="800" height="600"></canvas>
    <br>
    <label for="textInput">Enter text:</label>
    <input type="text" id="textInput">
    <br>
    <label for="fontSize">Font Size:</label>
    <input type="number" id="fontSize" min="8" max="72" value="16">
    <br>
    <label for="fontFamily">Font Family:</label>
    <select id="fontFamily">
        <option value="Arial">Arial</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Courier New">Courier New</option>
       
    </select>
    <br>
    <button onclick="addText()">Add Text</button>
    <br>
    <button onclick="saveImage()">Save Image</button>
    <h3>Mark Coordinates</h3>
    <canvas id="coordinateCanvas" width="800" height="600" onclick="markCoordinates(event)"></canvas>
    <br>
    <label for="nameColumn">Name a Column:</label>
    <input type="text" id="nameColumn">
    <br>
    <label for="xCoord">X Coordinate:</label>
    <input type="number" id="xCoord">
    <br>
    <label for="yCoord">Y Coordinate:</label>
    <input type="number" id="yCoord">
    <br>
    <button onclick="generateCertificates()">Generate Certificates</button>
    </div>
    <input type="file" id="imageFileInput">
    <button onclick="uploadImage()">Upload Image</button>
    <div id="coordinatesDisplay"></div>

    <script>
        const canvas = document.getElementById('imageCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let startX, startY;
        let templateImage = new Image();

        function loadTemplate() {
            const template = document.getElementById('template').value;
            templateImage.onload = function () {
                const aspectRatio = templateImage.width / templateImage.height;
                let newWidth, newHeight;

                if (aspectRatio > canvas.width / canvas.height) {
                    newWidth = canvas.width;
                    newHeight = canvas.width / aspectRatio;
                } else {
                    newWidth = canvas.height * aspectRatio;
                    newHeight = canvas.height;
                }

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(templateImage, 0, 0, newWidth, newHeight);
            };
            templateImage.src = template;
        }

        canvas.addEventListener('mousedown', (event) => {
            isDrawing = true;
            startX = event.offsetX;
            startY = event.offsetY;
        });

        canvas.addEventListener('mousemove', (event) => {
            if (isDrawing) {
                drawText(event.offsetX, event.offsetY);
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDrawing = false;
        });

        function drawText(x, y) {
            const text = document.getElementById('textInput').value;
            const fontSize = document.getElementById('fontSize').value;
            const fontFamily = document.getElementById('fontFamily').value;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(templateImage, 0, 0, canvas.width, canvas.height);

            ctx.font = `${fontSize}px ${fontFamily}`;
            ctx.fillText(text, x, y);
        }

        function addText() {
            const text = document.getElementById('textInput').value;
            const fontSize = document.getElementById('fontSize').value;
            const fontFamily = document.getElementById('fontFamily').value;

            ctx.font = `${fontSize}px ${fontFamily}`;
            ctx.fillText(text, startX, startY);
        }

        function saveImage() {
            const image = canvas.toDataURL('image/jpeg');
            fetch('/save_image', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ image: image })
            })
            .then(response => response.blob())
            .then(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'edited_image.jpg';
                a.click();
            })
            .catch(error => console.error('Error:', error));
        }
        function generateCertificates() {
            const nameColumn = document.getElementById('nameColumn').value;
            const xCoord = parseInt(document.getElementById('xCoord').value);
            const yCoord = parseInt(document.getElementById('yCoord').value);
            const fontSize = document.getElementById('fontSize').value;
            const fontFamily = document.getElementById('fontFamily').value;
            const textColor = document.getElementById('textColor').value;

            if (!nameColumn || isNaN(xCoord) || isNaN(yCoord)) {
                alert('Please enter valid input values.');
                return;
            }

            const columnIndex = namesData[0].indexOf(nameColumn);
            if (columnIndex === -1) {
                alert('Name column not found in the Excel file.');
                return;
            }

            const names = namesData.slice(1).map(row => row[columnIndex]);

            // Draw text on the coordinate canvas
            coordCtx.font = `${fontSize}px ${fontFamily}`;
            coordCtx.fillStyle = textColor; // Set text color
            names.forEach((name, index) => {
                const yPos = yCoord + index * (parseInt(fontSize) + 5); // Adjust spacing between names
                coordCtx.fillText(name, xCoord, yPos);
            });

            // Generate certificates as a downloadable PDF
            const pdf = new jsPDF();
            const imgData = coordinateCanvas.toDataURL('image/jpeg', 1.0);
            pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297); // A4 size: 210x297 mm
            pdf.save('certificates.pdf');
        }
        
        function uploadImage() {
            const imageFileInput = document.getElementById('imageFileInput');
            const file = imageFileInput.files[0];

            if (!file) {
                alert('Please select an image file.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const image = new Image();
                image.onload = function () {
                    const coordCanvas = document.getElementById('coordinateCanvas');
                    const coordCtx = coordCanvas.getContext('2d');
                    coordCtx.clearRect(0, 0, coordCanvas.width, coordCanvas.height);
                    coordCtx.drawImage(image, 0, 0, coordCanvas.width, coordCanvas.height);
                };
                image.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function markCoordinates(event) {
            const x = event.offsetX;
            const y = event.offsetY;

            document.getElementById('xCoord').value = x;
            document.getElementById('yCoord').value = y;

            const coordinatesDisplay = document.getElementById('coordinatesDisplay');
            
        }
       
        window.onload = loadTemplate;
    </script>
    </body>
    </html> 
    


    
    
